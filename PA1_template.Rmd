---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r set_options, echo=F, message=F}
require(knitr)
opts_chunk$set( fig.path = 'figure/' )
```

## Loading and preprocessing the data

The data is loaded and data and time objects are created.

```{r}
data<-read.csv(unz("activity.zip","activity.csv"))
data$time<-as.POSIXct(strptime(paste(data$date,formatC(data$interval,digits=3,flag="0")),"%Y-%m-%d %H%M",tz="UTC"))
data$date<-as.Date(data$date,"%Y-%m-%d")

```


## What is mean total number of steps taken per day?

```{r steps_per_day}
stepPerDay<-tapply(data$steps,data$date,sum,na.rm=TRUE);
hist(stepPerDay)
mean(stepPerDay)
median(stepPerDay)
```

The mean steps per day is `r mean(stepPerDay)` and the median is `r median(stepPerDay)`.

## What is the average daily activity pattern?

```{r daily_activiy_pattern}
stepPerInterval<-tapply(data$steps,data$interval,mean,na.rm=TRUE);
plot(as.numeric(names(stepPerInterval)),stepPerInterval,type="l")
names(which.max(stepPerInterval))
```

The interval `r names(which.max(stepPerInterval))` has an average of `r max(stepPerInterval)`, that is the maximum interval average.

## Imputing missing values

There are only missin value on steps and they are `r sum(is.na(data$steps))`.
```{r missing_values_estimate}
summary(data)
sum(is.na(data$steps))
auxData<-aggregate(data$steps,by=list(data$interval),FUN = median,na.rm=TRUE)
names(auxData)<-c("interval","median.steps")
auxData<-merge(data,auxData)
auxData$steps[is.na(auxData$steps)]<-auxData$median.steps[is.na(auxData$steps)]

stepPerDayAdj<-tapply(auxData$steps,auxData$date,sum,na.rm=TRUE);
hist(stepPerDayAdj)
mean(stepPerDayAdj)
median(stepPerDayAdj)
```

The adjusted mean steps per day is `r mean(stepPerDayAdj)` and the median is `r median(stepPerDayAdj)`.


## Are there differences in activity patterns between weekdays and weekends?

```{r pattern_weekdays}
Sys.setlocale("LC_TIME", "C");
data$weekday=as.factor(ifelse(weekdays(data$time,abbreviate = TRUE) %in% c("Sat","Sun"),"weekday","weekend"));
data$weekday=relevel(data$weekday,"weekday")
auxData<-aggregate(steps~interval+weekday,data=data,FUN = mean,na.rm=TRUE)
library(lattice)
xyplot(steps~interval|weekday,auxData,layou=c(1,2),type="l")
```

